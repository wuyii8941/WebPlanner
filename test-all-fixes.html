<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebPlanner ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
            background: #f8f9fa;
        }
        .test-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        .test-result {
            padding: 10px;
            border-radius: 4px;
            margin: 5px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            background: white;
            border: 1px solid #ddd;
        }
        .success {
            color: #28a745;
            border-left-color: #28a745;
        }
        .warning {
            color: #ffc107;
            border-left-color: #ffc107;
        }
        .error {
            color: #dc3545;
            border-left-color: #dc3545;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .summary {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            background: #e9ecef;
            text-align: center;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ WebPlanner ä¿®å¤æµ‹è¯•</h1>
        
        <div style="text-align: center; margin-bottom: 20px;">
            <button class="btn" onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <button class="btn" onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
        </div>

        <div id="testResults">
            <!-- æµ‹è¯•ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
        </div>
    </div>

    <script>
        // æµ‹è¯•å‡½æ•°
        async function testTripFormDuplicatePrevention() {
            const resultDiv = document.createElement('div');
            resultDiv.className = 'test-section';
            resultDiv.innerHTML = '<div class="test-title">ğŸ§ª æµ‹è¯•è¡Œç¨‹è¡¨å•é˜²é‡å¤æäº¤</div>';
            
            try {
                // æ¨¡æ‹Ÿå¿«é€Ÿå¤šæ¬¡ç‚¹å‡»
                const submitId1 = `submit_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                const submitId2 = `submit_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                
                // æ¨¡æ‹Ÿ5ç§’å†…çš„é‡å¤æäº¤
                localStorage.setItem('lastTripSubmitId', submitId1);
                localStorage.setItem('lastTripSubmitTime', Date.now().toString());
                
                // ç«‹å³å†æ¬¡æäº¤
                const isDuplicate = (() => {
                    const lastSubmitId = localStorage.getItem('lastTripSubmitId');
                    const lastSubmitTime = localStorage.getItem('lastTripSubmitTime');
                    
                    if (lastSubmitId && lastSubmitTime) {
                        const timeDiff = Date.now() - parseInt(lastSubmitTime);
                        return timeDiff < 5000;
                    }
                    return false;
                })();
                
                const result = document.createElement('div');
                result.className = 'test-result ' + (isDuplicate ? 'success' : 'error');
                result.textContent = isDuplicate ? 
                    'âœ… é˜²é‡å¤æœºåˆ¶å·¥ä½œæ­£å¸¸ - æ£€æµ‹åˆ°é‡å¤æäº¤' : 
                    'âŒ é˜²é‡å¤æœºåˆ¶å¯èƒ½æœ‰é—®é¢˜';
                
                resultDiv.appendChild(result);
                return isDuplicate;
            } catch (error) {
                const result = document.createElement('div');
                result.className = 'test-result error';
                result.textContent = 'âŒ é˜²é‡å¤æµ‹è¯•å¤±è´¥: ' + error.message;
                resultDiv.appendChild(result);
                return false;
            }
        }

        async function testMapService() {
            const resultDiv = document.createElement('div');
            resultDiv.className = 'test-section';
            resultDiv.innerHTML = '<div class="test-title">ğŸ—ºï¸ æµ‹è¯•åœ°å›¾æœåŠ¡</div>';
            
            try {
                // æµ‹è¯•åŸå¸‚åç§°æå–
                const testDestinations = [
                    'åŒ—äº¬æ•…å®«',
                    'ä¸Šæµ·å¸‚ä¸­å¿ƒ',
                    'å¹¿å·å¡”',
                    'æ·±åœ³ä¸–ç•Œä¹‹çª—',
                    'æ­å·è¥¿æ¹–',
                    'æˆéƒ½å®½çª„å··å­',
                    'é‡åº†æ´ªå´–æ´',
                    'è¥¿å®‰å…µé©¬ä¿‘',
                    'å—äº¬å¤«å­åº™',
                    'æ­¦æ±‰é»„é¹¤æ¥¼'
                ];
                
                const extractCityFromDestination = (destination) => {
                    const cityMap = {
                        'åŒ—äº¬': 'åŒ—äº¬å¸‚',
                        'ä¸Šæµ·': 'ä¸Šæµ·å¸‚',
                        'å¹¿å·': 'å¹¿å·å¸‚',
                        'æ·±åœ³': 'æ·±åœ³å¸‚',
                        'æ­å·': 'æ­å·å¸‚',
                        'æˆéƒ½': 'æˆéƒ½å¸‚',
                        'é‡åº†': 'é‡åº†å¸‚',
                        'è¥¿å®‰': 'è¥¿å®‰å¸‚',
                        'å—äº¬': 'å—äº¬å¸‚',
                        'æ­¦æ±‰': 'æ­¦æ±‰å¸‚'
                    };
                    
                    for (const [key, value] of Object.entries(cityMap)) {
                        if (destination.includes(key)) {
                            return value;
                        }
                    }
                    return 'å…¨å›½';
                };
                
                const result = document.createElement('div');
                result.className = 'test-result';
                
                let output = '';
                testDestinations.forEach(dest => {
                    const city = extractCityFromDestination(dest);
                    output += `ğŸ“ ${dest} -> ${city}\n`;
                });
                output += 'âœ… åœ°å›¾æœåŠ¡åŸå¸‚æå–åŠŸèƒ½æ­£å¸¸';
                
                result.textContent = output;
                resultDiv.appendChild(result);
                return true;
            } catch (error) {
                const result = document.createElement('div');
                result.className = 'test-result error';
                result.textContent = 'âŒ åœ°å›¾æœåŠ¡æµ‹è¯•å¤±è´¥: ' + error.message;
                resultDiv.appendChild(result);
                return false;
            }
        }

        async function testNavigationService() {
            const resultDiv = document.createElement('div');
            resultDiv.className = 'test-section';
            resultDiv.innerHTML = '<div class="test-title">ğŸ§­ æµ‹è¯•å¯¼èˆªæœåŠ¡</div>';
            
            try {
                // æµ‹è¯•é™çº§æ–¹æ¡ˆ
                const getFallbackRoute = (start, end, type) => {
                    const baseDistance = 5000;
                    const baseDuration = 1200;
                    
                    let distance, duration;
                    switch (type) {
                        case 'driving':
                            distance = baseDistance + Math.random() * 10000;
                            duration = baseDuration + Math.random() * 1800;
                            break;
                        case 'transit':
                            distance = baseDistance + Math.random() * 5000;
                            duration = baseDuration + Math.random() * 2400;
                            break;
                        case 'walking':
                            distance = baseDistance + Math.random() * 2000;
                            duration = baseDuration * 2 + Math.random() * 1800;
                            break;
                        default:
                            distance = baseDistance;
                            duration = baseDuration;
                    }
                    
                    return [{
                        type: type,
                        distance: Math.round(distance),
                        duration: Math.round(duration),
                        tolls: type === 'driving' ? Math.round(Math.random() * 50) : 0,
                        steps: [{
                            instruction: `ä» ${start} å‰å¾€ ${end}`,
                            distance: Math.round(distance),
                            duration: Math.round(duration)
                        }]
                    }];
                };
                
                const testRoutes = [
                    { start: 'åŒ—äº¬æ•…å®«', end: 'å¤©å®‰é—¨', type: 'driving' },
                    { start: 'ä¸Šæµ·å¤–æ»©', end: 'ä¸œæ–¹æ˜ç ', type: 'transit' },
                    { start: 'å¹¿å·å¡”', end: 'ç æ±Ÿæ–°åŸ', type: 'walking' }
                ];
                
                const result = document.createElement('div');
                result.className = 'test-result';
                
                let output = '';
                testRoutes.forEach(route => {
                    const routeResult = getFallbackRoute(route.start, route.end, route.type);
                    output += `ğŸ›£ï¸ ${route.start} -> ${route.end} (${route.type}): ${Math.round(routeResult[0].distance/1000)}km, ${Math.round(routeResult[0].duration/60)}min\n`;
                });
                output += 'âœ… å¯¼èˆªæœåŠ¡é™çº§æ–¹æ¡ˆæ­£å¸¸';
                
                result.textContent = output;
                resultDiv.appendChild(result);
                return true;
            } catch (error) {
                const result = document.createElement('div');
                result.className = 'test-result error';
                result.textContent = 'âŒ å¯¼èˆªæœåŠ¡æµ‹è¯•å¤±è´¥: ' + error.message;
                resultDiv.appendChild(result);
                return false;
            }
        }

        async function testAIServiceNetwork() {
            const resultDiv = document.createElement('div');
            resultDiv.className = 'test-section';
            resultDiv.innerHTML = '<div class="test-title">ğŸ¤– æµ‹è¯•AIæœåŠ¡ç½‘ç»œæ£€æµ‹</div>';
            
            try {
                // æ¨¡æ‹Ÿç½‘ç»œçŠ¶æ€æ£€æŸ¥
                const checkNetworkStatus = async () => {
                    try {
                        // æ¨¡æ‹Ÿç½‘ç»œæ£€æŸ¥
                        const basicNetwork = Math.random() > 0.2; // 80% æ¦‚ç‡ç½‘ç»œæ­£å¸¸
                        const apiEndpoint = Math.random() > 0.3; // 70% æ¦‚ç‡APIæ­£å¸¸
                        
                        return {
                            basicNetwork,
                            apiEndpoint,
                            overall: basicNetwork && apiEndpoint
                        };
                    } catch (error) {
                        return {
                            basicNetwork: false,
                            apiEndpoint: false,
                            overall: false
                        };
                    }
                };
                
                const status = await checkNetworkStatus();
                
                const result = document.createElement('div');
                result.className = 'test-result ' + (status.overall ? 'success' : 'warning');
                
                let output = `ğŸ“Š ç½‘ç»œçŠ¶æ€:\n`;
                output += `â€¢ åŸºç¡€ç½‘ç»œ: ${status.basicNetwork ? 'âœ… æ­£å¸¸' : 'âŒ å¼‚å¸¸'}\n`;
                output += `â€¢ APIç«¯ç‚¹: ${status.apiEndpoint ? 'âœ… æ­£å¸¸' : 'âŒ å¼‚å¸¸'}\n`;
                output += `â€¢ æ€»ä½“çŠ¶æ€: ${status.overall ? 'âœ… æ­£å¸¸' : 'âš ï¸ ä¸ç¨³å®š'}\n\n`;
                output += status.overall ? 
                    'âœ… ç½‘ç»œè¿æ¥æ­£å¸¸ï¼ŒAIæœåŠ¡å¯ç”¨' : 
                    'âš ï¸ ç½‘ç»œè¿æ¥ä¸ç¨³å®šï¼ŒAIæœåŠ¡å¯èƒ½éœ€è¦é‡è¯•';
                
                result.textContent = output;
                resultDiv.appendChild(result);
                return status.overall;
            } catch (error) {
                const result = document.createElement('div');
                result.className = 'test-result error';
                result.textContent = 'âŒ AIæœåŠ¡ç½‘ç»œæµ‹è¯•å¤±è´¥: ' + error.message;
                resultDiv.appendChild(result);
                return false;
            }
        }

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<div style="text-align: center; padding: 20px;">ğŸ”„ æµ‹è¯•ä¸­...</div>';
            
            const results = {
                tripForm: await testTripFormDuplicatePrevention(),
                mapService: await testMapService(),
                navigationService: await testNavigationService(),
                aiService: await testAIServiceNetwork()
            };
            
            // æ˜¾ç¤ºæ±‡æ€»ç»“æœ
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'summary';
            
            const allPassed = Object.values(results).every(result => result);
            const passedCount = Object.values(results).filter(result => result).length;
            
            summaryDiv.innerHTML = `
                <h3>ğŸ“Š æµ‹è¯•ç»“æœæ±‡æ€»</h3>
                <p>é€šè¿‡: ${passedCount}/4 é¡¹æµ‹è¯•</p>
                <p style="color: ${allPassed ? '#28a745' : '#dc3545'}; font-size: 18px;">
                    ${allPassed ? 'ğŸ‰ æ‰€æœ‰ä¿®å¤å·²æˆåŠŸéªŒè¯ï¼' : 'âš ï¸ éƒ¨åˆ†åŠŸèƒ½éœ€è¦è¿›ä¸€æ­¥è°ƒè¯•'}
                </p>
            `;
            
            resultsDiv.appendChild(summaryDiv);
        }

        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
            localStorage.removeItem('lastTripSubmitId');
            localStorage.removeItem('lastTripSubmitTime');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.onload = function() {
            console.log('ğŸš€ WebPlanner ä¿®å¤æµ‹è¯•é¡µé¢å·²åŠ è½½');
        };
    </script>
</body>
</html>
