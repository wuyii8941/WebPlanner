<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIæœåŠ¡ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { border-color: #4CAF50; background-color: #f8fff8; }
        .error { border-color: #f44336; background-color: #fff8f8; }
        .info { border-color: #2196F3; background-color: #f8fcff; }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background-color: #45a049; }
        button:disabled { background-color: #cccccc; cursor: not-allowed; }
        .log {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 10px;
            margin-top: 10px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ AIæœåŠ¡ä¿®å¤æµ‹è¯•</h1>
        <p>æ­¤é¡µé¢ç”¨äºæµ‹è¯•AIæœåŠ¡æ˜¯å¦å·²ä¿®å¤ä¸ºç›´è¿æ¨¡å¼ï¼Œä¸ç»è¿‡ä»£ç†ã€‚</p>
        
        <div class="test-section info">
            <h3>ğŸ“‹ æµ‹è¯•è¯´æ˜</h3>
            <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æ¥æµ‹è¯•AIæœåŠ¡è¿æ¥ã€‚æµ‹è¯•å°†ï¼š</p>
            <ul>
                <li>æ£€æŸ¥APIå¯†é’¥é…ç½®</li>
                <li>éªŒè¯ç½‘ç»œè¿æ¥</li>
                <li>æµ‹è¯•AIæœåŠ¡ç›´è¿æ¨¡å¼</li>
                <li>æ˜¾ç¤ºè¯¦ç»†çš„è¯Šæ–­ä¿¡æ¯</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>ğŸ”§ è¿è¡Œæµ‹è¯•</h3>
            <button onclick="runAITest()">è¿è¡ŒAIæœåŠ¡æµ‹è¯•</button>
            <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
            
            <div id="log" class="log"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š æµ‹è¯•ç»“æœ</h3>
            <div id="results"></div>
        </div>
    </div>

    <script>
        let logElement = document.getElementById('log');
        let resultsElement = document.getElementById('results');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color: #666">[${timestamp}]</span> ${message}`;
            logEntry.style.color = type === 'error' ? '#d32f2f' : 
                                 type === 'success' ? '#388e3c' : '#1976d2';
            logElement.appendChild(logEntry);
            logElement.scrollTop = logElement.scrollHeight;
        }

        function clearLog() {
            logElement.innerHTML = '';
            resultsElement.innerHTML = '';
        }

        async function runAITest() {
            clearLog();
            log('ğŸš€ å¼€å§‹AIæœåŠ¡æµ‹è¯•...', 'info');

            try {
                // 1. æ£€æŸ¥APIå¯†é’¥é…ç½®
                log('ğŸ”‘ æ£€æŸ¥APIå¯†é’¥é…ç½®...', 'info');
                const apiKeys = localStorage.getItem('webplanner_api_keys');
                if (!apiKeys) {
                    log('âŒ æœªæ‰¾åˆ°APIå¯†é’¥é…ç½®ï¼Œè¯·åœ¨WebPlanneråº”ç”¨ä¸­é…ç½®APIå¯†é’¥', 'error');
                    return;
                }
                
                const keys = JSON.parse(apiKeys);
                log(`âœ… APIå¯†é’¥çŠ¶æ€: ${keys.llmApiKey ? 'å·²é…ç½®' : 'æœªé…ç½®'}`, 'success');
                
                if (!keys.llmApiKey) {
                    log('âŒ è¯·å…ˆåœ¨WebPlannerè®¾ç½®ä¸­é…ç½®DeepSeek APIå¯†é’¥', 'error');
                    return;
                }

                // 2. æ£€æŸ¥ä»£ç†è®¾ç½®
                log('ğŸŒ æ£€æŸ¥ä»£ç†è®¾ç½®...', 'info');
                const settings = localStorage.getItem('webplanner_settings');
                if (settings) {
                    const parsedSettings = JSON.parse(settings);
                    log(`ğŸ“Š ä»£ç†è®¾ç½®: ${parsedSettings.useProxyForAI ? 'ä½¿ç”¨ä»£ç†' : 'ç›´è¿æ¨¡å¼'}`, 'info');
                } else {
                    log('ğŸ“Š ä»£ç†è®¾ç½®: ç›´è¿æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰', 'info');
                }

                // 3. æµ‹è¯•ç½‘ç»œè¿æ¥
                log('\nğŸŒ æµ‹è¯•ç½‘ç»œè¿æ¥...', 'info');
                const testUrls = [
                    'https://api.deepseek.com/v1/models',
                    'https://www.google.com'
                ];
                
                for (const url of testUrls) {
                    try {
                        const startTime = Date.now();
                        const response = await fetch(url, {
                            method: 'HEAD',
                            signal: AbortSignal.timeout(10000)
                        });
                        const endTime = Date.now();
                        log(`âœ… ${url} - è¿æ¥æˆåŠŸ (${endTime - startTime}ms)`, 'success');
                    } catch (error) {
                        log(`âŒ ${url} - è¿æ¥å¤±è´¥: ${error.message}`, 'error');
                    }
                }

                // 4. æµ‹è¯•AIæœåŠ¡æ¨¡å—
                log('\nğŸ¤– æµ‹è¯•AIæœåŠ¡æ¨¡å—...', 'info');
                try {
                    // åŠ¨æ€å¯¼å…¥AIæœåŠ¡æ¨¡å—
                    const { aiService } = await import('http://localhost:5173/src/services/aiService.js');
                    log('âœ… AIæœåŠ¡æ¨¡å—åŠ è½½æˆåŠŸ', 'success');

                    // æµ‹è¯•ç½‘ç»œè¯Šæ–­
                    log('ğŸ”§ è¿è¡Œç½‘ç»œè¯Šæ–­...', 'info');
                    const diagnosis = await aiService.diagnoseConnection();
                    log(`ğŸ“Š ç½‘ç»œè¯Šæ–­ç»“æœ: ${diagnosis.overallStatus}`, 
                        diagnosis.overallStatus === 'healthy' ? 'success' : 'error');
                    
                    // æ˜¾ç¤ºè¯¦ç»†è¯Šæ–­ç»“æœ
                    resultsElement.innerHTML = `
                        <div class="test-section ${diagnosis.overallStatus === 'healthy' ? 'success' : 'error'}">
                            <h4>ğŸ” è¯¦ç»†è¯Šæ–­ç»“æœ</h4>
                            <ul>
                                <li>DNSè§£æ: ${diagnosis.dnsResolution ? 'âœ… æ­£å¸¸' : 'âŒ å¤±è´¥'}</li>
                                <li>APIç«¯ç‚¹å¯è¾¾æ€§: ${diagnosis.apiEndpointReachable ? 'âœ… æ­£å¸¸' : 'âŒ å¤±è´¥'}</li>
                                <li>SSLè¿æ¥: ${diagnosis.sslConnection ? 'âœ… æ­£å¸¸' : 'âŒ å¤±è´¥'}</li>
                                <li>APIå¯†é’¥æœ‰æ•ˆæ€§: ${diagnosis.apiKeyValid ? 'âœ… æ­£å¸¸' : 'âŒ å¤±è´¥'}</li>
                                <li>æ€»ä½“çŠ¶æ€: <strong>${diagnosis.overallStatus}</strong></li>
                            </ul>
                        </div>
                    `;

                    if (diagnosis.overallStatus === 'healthy') {
                        log('ğŸ‰ AIæœåŠ¡ä¿®å¤æˆåŠŸï¼ç°åœ¨ä½¿ç”¨ç›´è¿æ¨¡å¼ï¼Œä¸ç»è¿‡ä»£ç†ã€‚', 'success');
                    } else {
                        log('âš ï¸ AIæœåŠ¡ä»æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒAPIå¯†é’¥é…ç½®ã€‚', 'error');
                    }

                } catch (error) {
                    log(`âŒ AIæœåŠ¡æ¨¡å—æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                }

            } catch (error) {
                log(`âŒ æµ‹è¯•è¿‡ç¨‹ä¸­å‡ºé”™: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥WebPlanneræ˜¯å¦è¿è¡Œ
        window.addEventListener('load', () => {
            fetch('http://localhost:5173')
                .then(() => log('âœ… WebPlanneråº”ç”¨æ­£åœ¨è¿è¡Œ', 'success'))
                .catch(() => log('âŒ WebPlanneråº”ç”¨æœªè¿è¡Œï¼Œè¯·å…ˆå¯åŠ¨å¼€å‘æœåŠ¡å™¨', 'error'));
        });
    </script>
</body>
</html>
