<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¢å¼ºåœ°å›¾æ ‡è®°æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            background: #f8f9fa;
        }
        .success {
            color: #155724;
            background: #d4edda;
            border: 1px solid #c3e6cb;
        }
        .error {
            color: #721c24;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
        }
        .info {
            color: #0c5460;
            background: #d1ecf1;
            border: 1px solid #bee5eb;
        }
        #map-container {
            width: 100%;
            height: 500px;
            margin: 20px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .itinerary-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .itinerary-item {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            background: #f8fafc;
        }
        .category-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 8px;
        }
        .sightseeing { background: #dbeafe; color: #1e40af; }
        .dining { background: #dcfce7; color: #166534; }
        .accommodation { background: #f3e8ff; color: #7e22ce; }
        .transportation { background: #ffedd5; color: #c2410c; }
        .activity { background: #fce7f3; color: #be185d; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ—ºï¸ å¢å¼ºåœ°å›¾æ ‡è®°åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>æµ‹è¯•è¯´æ˜</h3>
            <p>è¿™ä¸ªé¡µé¢æµ‹è¯•å¢å¼ºåçš„åœ°å›¾æ ‡è®°åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š</p>
            <ul>
                <li>âœ… å½©è‰²åˆ†ç±»æ ‡è®°ï¼ˆä¸åŒç±»åˆ«ä½¿ç”¨ä¸åŒé¢œè‰²ï¼‰</li>
                <li>âœ… ç¼–å·æ ‡è®°ï¼ˆæ¯ä¸ªæ ‡è®°éƒ½æœ‰åºå·ï¼‰</li>
                <li>âœ… è¯¦ç»†çš„ä¿¡æ¯çª—å£</li>
                <li>âœ… æ ‡è®°è¿çº¿åŠŸèƒ½</li>
                <li>âœ… æ™ºèƒ½ç¼©æ”¾å’Œä¸­å¿ƒå®šä½</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>æµ‹è¯•è¡Œç¨‹æ•°æ®</h3>
            <div class="itinerary-list">
                <div class="itinerary-item">
                    <div class="category-badge sightseeing">æ™¯ç‚¹</div>
                    <h4>å—äº¬å—ç«™</h4>
                    <p><strong>æ—¶é—´:</strong> 09:00 (60åˆ†é’Ÿ)</p>
                    <p><strong>åœ°ç‚¹:</strong> å—äº¬å—ç«™</p>
                    <p><strong>è´¹ç”¨:</strong> Â¥0</p>
                </div>
                <div class="itinerary-item">
                    <div class="category-badge dining">é¤é¥®</div>
                    <h4>æ–°è¡—å£é™„è¿‘å°åƒåº—</h4>
                    <p><strong>æ—¶é—´:</strong> 12:00 (90åˆ†é’Ÿ)</p>
                    <p><strong>åœ°ç‚¹:</strong> æ–°è¡—å£</p>
                    <p><strong>è´¹ç”¨:</strong> Â¥80</p>
                </div>
                <div class="itinerary-item">
                    <div class="category-badge sightseeing">æ™¯ç‚¹</div>
                    <h4>å¤«å­åº™æ™¯åŒº</h4>
                    <p><strong>æ—¶é—´:</strong> 14:00 (120åˆ†é’Ÿ)</p>
                    <p><strong>åœ°ç‚¹:</strong> å¤«å­åº™</p>
                    <p><strong>è´¹ç”¨:</strong> Â¥60</p>
                </div>
                <div class="itinerary-item">
                    <div class="category-badge dining">é¤é¥®</div>
                    <h4>å¤«å­åº™ç¾é£Ÿè¡—</h4>
                    <p><strong>æ—¶é—´:</strong> 17:00 (90åˆ†é’Ÿ)</p>
                    <p><strong>åœ°ç‚¹:</strong> å¤«å­åº™ç¾é£Ÿè¡—</p>
                    <p><strong>è´¹ç”¨:</strong> Â¥120</p>
                </div>
                <div class="itinerary-item">
                    <div class="category-badge sightseeing">æ™¯ç‚¹</div>
                    <h4>æ˜å­é™µæ™¯åŒº</h4>
                    <p><strong>æ—¶é—´:</strong> 09:00 (120åˆ†é’Ÿ)</p>
                    <p><strong>åœ°ç‚¹:</strong> æ˜å­é™µ</p>
                    <p><strong>è´¹ç”¨:</strong> Â¥70</p>
                </div>
                <div class="itinerary-item">
                    <div class="category-badge dining">é¤é¥®</div>
                    <h4>ä¸­å±±é™µæ™¯åŒºå‘¨è¾¹é¤å…</h4>
                    <p><strong>æ—¶é—´:</strong> 12:00 (90åˆ†é’Ÿ)</p>
                    <p><strong>åœ°ç‚¹:</strong> ä¸­å±±é™µé™„è¿‘</p>
                    <p><strong>è´¹ç”¨:</strong> Â¥100</p>
                </div>
                <div class="itinerary-item">
                    <div class="category-badge sightseeing">æ™¯ç‚¹</div>
                    <h4>ä¸­å±±é™µæ™¯åŒº</h4>
                    <p><strong>æ—¶é—´:</strong> 14:00 (180åˆ†é’Ÿ)</p>
                    <p><strong>åœ°ç‚¹:</strong> ä¸­å±±é™µ</p>
                    <p><strong>è´¹ç”¨:</strong> Â¥0</p>
                </div>
                <div class="itinerary-item">
                    <div class="category-badge activity">æ´»åŠ¨</div>
                    <h4>æ–°è¡—å£å•†ä¸šåŒº</h4>
                    <p><strong>æ—¶é—´:</strong> 17:00 (120åˆ†é’Ÿ)</p>
                    <p><strong>åœ°ç‚¹:</strong> æ–°è¡—å£å•†ä¸šåŒº</p>
                    <p><strong>è´¹ç”¨:</strong> Â¥200</p>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3>æµ‹è¯•æ“ä½œ</h3>
            <button class="test-button" onclick="testEnhancedMarkers()">æµ‹è¯•å¢å¼ºæ ‡è®°</button>
            <button class="test-button" onclick="testSingleMarker()">æµ‹è¯•å•ä¸ªæ ‡è®°</button>
            <button class="test-button" onclick="testCategoryMarkers()">æµ‹è¯•åˆ†ç±»æ ‡è®°</button>
            <button class="test-button" onclick="clearMap()">æ¸…é™¤åœ°å›¾</button>
        </div>

        <div id="map-container">
            <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #f5f5f5; color: #666;">
                <div style="text-align: center;">
                    <div style="font-size: 48px; margin-bottom: 10px;">ğŸ—ºï¸</div>
                    <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æµ‹è¯•å¢å¼ºåœ°å›¾æ ‡è®°åŠŸèƒ½</p>
                </div>
            </div>
        </div>

        <div id="results" class="test-section">
            <h3>æµ‹è¯•ç»“æœ</h3>
            <div id="result-content"></div>
        </div>
    </div>

    <script>
        let mapService = null;
        let map = null;

        // æ¨¡æ‹Ÿè¡Œç¨‹æ•°æ®
        const mockItinerary = [
            {
                title: 'å—äº¬å—ç«™',
                category: 'transportation',
                time: '09:00',
                duration: 60,
                location: 'å—äº¬å—ç«™',
                cost: 0,
                description: 'åˆ°è¾¾å—äº¬ï¼Œå¼€å§‹æ—…ç¨‹'
            },
            {
                title: 'æ–°è¡—å£é™„è¿‘å°åƒåº—',
                category: 'dining',
                time: '12:00',
                duration: 90,
                location: 'æ–°è¡—å£',
                cost: 80,
                description: 'å“å°å—äº¬ç‰¹è‰²å°åƒ'
            },
            {
                title: 'å¤«å­åº™æ™¯åŒº',
                category: 'sightseeing',
                time: '14:00',
                duration: 120,
                location: 'å¤«å­åº™',
                cost: 60,
                description: 'å‚è§‚å†å²æ–‡åŒ–æ™¯åŒº'
            },
            {
                title: 'å¤«å­åº™ç¾é£Ÿè¡—',
                category: 'dining',
                time: '17:00',
                duration: 90,
                location: 'å¤«å­åº™ç¾é£Ÿè¡—',
                cost: 120,
                description: 'ç»§ç»­å“å°ç¾é£Ÿ'
            },
            {
                title: 'æ˜å­é™µæ™¯åŒº',
                category: 'sightseeing',
                time: '09:00',
                duration: 120,
                location: 'æ˜å­é™µ',
                cost: 70,
                description: 'å‚è§‚æ˜æœçš‡é™µ'
            },
            {
                title: 'ä¸­å±±é™µæ™¯åŒºå‘¨è¾¹é¤å…',
                category: 'dining',
                time: '12:00',
                duration: 90,
                location: 'ä¸­å±±é™µé™„è¿‘',
                cost: 100,
                description: 'åˆé¤ä¼‘æ¯'
            },
            {
                title: 'ä¸­å±±é™µæ™¯åŒº',
                category: 'sightseeing',
                time: '14:00',
                duration: 180,
                location: 'ä¸­å±±é™µ',
                cost: 0,
                description: 'å‚è§‚å­™ä¸­å±±é™µå¢“'
            },
            {
                title: 'æ–°è¡—å£å•†ä¸šåŒº',
                category: 'activity',
                time: '17:00',
                duration: 120,
                location: 'æ–°è¡—å£å•†ä¸šåŒº',
                cost: 200,
                description: 'è´­ç‰©å’Œä¼‘é—²'
            }
        ];

        // åˆå§‹åŒ–åœ°å›¾æœåŠ¡
        async function initMapService() {
            if (!mapService) {
                // åŠ¨æ€å¯¼å…¥åœ°å›¾æœåŠ¡
                const module = await import('./src/services/mapService.js');
                mapService = module.mapService;
            }
            return mapService;
        }

        // æµ‹è¯•å¢å¼ºæ ‡è®°åŠŸèƒ½
        async function testEnhancedMarkers() {
            const service = await initMapService();
            const resultDiv = document.getElementById('result-content');
            
            try {
                resultDiv.innerHTML = '<div class="info">ğŸ—ºï¸ å¼€å§‹æµ‹è¯•å¢å¼ºåœ°å›¾æ ‡è®°åŠŸèƒ½...</div>';
                
                // åˆå§‹åŒ–åœ°å›¾
                if (!map) {
                    await service.initMap('map-container');
                    map = service.map;
                }
                
                // æ·»åŠ å¢å¼ºæ ‡è®°
                const markers = await service.addItineraryMarkers(mockItinerary);
                
                // æ˜¾ç¤ºç»“æœ
                const result = `
                    <div class="success">
                        <strong>âœ… å¢å¼ºæ ‡è®°åŠŸèƒ½æµ‹è¯•æˆåŠŸ!</strong><br>
                        æˆåŠŸæ·»åŠ æ ‡è®°: ${markers.length}/${mockItinerary.length} ä¸ª<br>
                        åŠŸèƒ½åŒ…æ‹¬:
                        <ul>
                            <li>âœ… å½©è‰²åˆ†ç±»æ ‡è®°ï¼ˆä¸åŒç±»åˆ«ä¸åŒé¢œè‰²ï¼‰</li>
                            <li>âœ… ç¼–å·æ ‡è®°ï¼ˆæ¯ä¸ªæ ‡è®°éƒ½æœ‰åºå·ï¼‰</li>
                            <li>âœ… è¯¦ç»†çš„ä¿¡æ¯çª—å£</li>
                            <li>âœ… æ ‡è®°è¿çº¿åŠŸèƒ½</li>
                            <li>âœ… æ™ºèƒ½ç¼©æ”¾å’Œä¸­å¿ƒå®šä½</li>
                        </ul>
                    </div>
                `;
                resultDiv.innerHTML += result;
                
            } catch (error) {
                resultDiv.innerHTML += `<div class="error">âŒ å¢å¼ºæ ‡è®°åŠŸèƒ½æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
            }
        }

        // æµ‹è¯•å•ä¸ªæ ‡è®°
        async function testSingleMarker() {
            const service = await initMapService();
            const resultDiv = document.getElementById('result-content');
            
            try {
                resultDiv.innerHTML = '<div class="info">ğŸ—ºï¸ å¼€å§‹æµ‹è¯•å•ä¸ªæ ‡è®°...</div>';
                
                // åˆå§‹åŒ–åœ°å›¾
                if (!map) {
                    await service.initMap('map-container');
                    map = service.map;
                }
                
                // æ¸…é™¤ç°æœ‰æ ‡è®°
                service.clearMarkers();
                
                // æ·»åŠ å•ä¸ªæ ‡è®°
                const singleItinerary = [mockItinerary[0]];
                const markers = await service.addItineraryMarkers(singleItinerary);
                
                // æ˜¾ç¤ºç»“æœ
                const result = `
                    <div class="success">
                        <strong>âœ… å•ä¸ªæ ‡è®°æµ‹è¯•æˆåŠŸ!</strong><br>
                        å•ä¸ªåœ°ç‚¹æ—¶åœ°å›¾ä¼šè‡ªåŠ¨æ”¾å¤§æ˜¾ç¤º<br>
                        æ ‡è®°åŒ…å«ç±»åˆ«å›¾æ ‡å’Œç¼–å·
                    </div>
                `;
                resultDiv.innerHTML += result;
                
            } catch (error) {
                resultDiv.innerHTML += `<div class="error">âŒ å•ä¸ªæ ‡è®°æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
            }
        }

        // æµ‹è¯•åˆ†ç±»æ ‡è®°
        async function testCategoryMarkers() {
            const service = await initMapService();
            const resultDiv = document.getElementById('result-content');
            
            try {
                resultDiv.innerHTML = '<div class="info">ğŸ—ºï¸ å¼€å§‹æµ‹è¯•åˆ†ç±»æ ‡è®°...</div>';
                
                // åˆå§‹åŒ–åœ°å›¾
                if (!map) {
                    await service.initMap('map-container');
                    map = service.map;
                }
                
                // æ¸…é™¤ç°æœ‰æ ‡è®°
                service.clearMarkers();
                
                // æŒ‰ç±»åˆ«åˆ†ç»„æµ‹è¯•
                const categories = ['sightseeing', 'dining', 'activity'];
                const categoryItinerary = mockItinerary.filter(item => 
                    categories.includes(item.category)
                );
                
                const markers = await service.addItineraryMarkers(categoryItinerary);
                
                // æ˜¾ç¤ºç»“æœ
                const result = `
                    <div class="success">
                        <strong>âœ… åˆ†ç±»æ ‡è®°æµ‹è¯•æˆåŠŸ!</strong><br>
                        ä¸åŒç±»åˆ«ä½¿ç”¨ä¸åŒé¢œè‰²æ ‡è®°:<br>
                        <ul>
                            <li>ğŸ”µ è“è‰² - æ™¯ç‚¹ (sightseeing)</li>
                            <li>ğŸŸ¢ ç»¿è‰² - é¤é¥® (dining)</li>
                            <li>ğŸŸ£ ç´«è‰² - ä½å®¿ (accommodation)</li>
                            <li>ğŸŸ  æ©™è‰² - äº¤é€š (transportation)</li>
                            <li>ğŸ”´ ç²‰è‰² - æ´»åŠ¨ (activity)</li>
                        </ul>
                    </div>
                `;
                resultDiv.innerHTML += result;
                
            } catch (error) {
                resultDiv.innerHTML += `<div class="error">âŒ åˆ†ç±»æ ‡è®°æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
            }
        }

        // æ¸…é™¤åœ°å›¾
        function clearMap() {
            if (mapService) {
                mapService.clearMarkers();
            }
            const mapContainer = document.getElementById('map-container');
            mapContainer.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #f5f5f5; color: #666;"><div style="text-align: center;"><div style="font-size: 48px; margin-bottom: 10px;">ğŸ—ºï¸</div><p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æµ‹è¯•å¢å¼ºåœ°å›¾æ ‡è®°åŠŸèƒ½</p></div></div>';
            map = null;
            document.getElementById('result-content').innerHTML = '';
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥API Key
        window.addEventListener('load', function() {
            const apiKeys = localStorage.getItem('webplanner_api_keys');
            if (!apiKeys || !JSON.parse(apiKeys).baiduApiKey) {
                document.getElementById('result-content').innerHTML = `
                    <div class="error">
                        <strong>âŒ æœªé…ç½®ç™¾åº¦åœ°å›¾API Key</strong><br>
                        è¯·åœ¨è®¾ç½®ä¸­é…ç½®ç™¾åº¦åœ°å›¾API Keyæ‰èƒ½æµ‹è¯•åœ°å›¾åŠŸèƒ½
                    </div>
                `;
            } else {
                document.getElementById('result-content').innerHTML = `
                    <div class="success">
                        <strong>âœ… API Keyå·²é…ç½®</strong><br>
                        å¯ä»¥å¼€å§‹æµ‹è¯•å¢å¼ºåœ°å›¾æ ‡è®°åŠŸèƒ½
                    </div>
                `;
            }
        });
    </script>
</body>
</html>
